"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9913],{9913:(j,S,d)=>{d.r(S),d.d(S,{SettlePageModule:()=>v});var h=d(177),g=d(4341),a=d(4488),m=d(8986),c=d(467),t=d(4438),F=d(6722);function p(l,r){if(1&l){const i=t.RV6();t.j41(0,"tr")(1,"td")(2,"ion-checkbox",33),t.bIt("ionChange",function(s){const n=t.eBV(i).$implicit,o=t.XpG();return t.Njj(o.onSettlementSelect(s,n))}),t.k0s()(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s(),t.j41(13,"td"),t.EFF(14),t.k0s(),t.j41(15,"td"),t.EFF(16),t.nI1(17,"date"),t.k0s(),t.j41(18,"td")(19,"ion-badge",34),t.EFF(20),t.k0s()()()}if(2&l){const i=r.$implicit,e=t.XpG();t.R7$(2),t.Y8G("checked",e.isSettlementSelected(i))("disabled",i.isSettled),t.R7$(2),t.JRh(i.orderId.orderId),t.R7$(2),t.JRh(i.dishId.name),t.R7$(2),t.JRh(i.quantity),t.R7$(2),t.SpI("\u20b9",i.partnerPrice,""),t.R7$(2),t.SpI("\u20b9",i.adminEarning,""),t.R7$(2),t.SpI("\u20b9",i.totalPartnerEarning,""),t.R7$(2),t.JRh(t.i5U(17,11,i.createdAt,"medium")),t.R7$(3),t.Y8G("color",i.isSettled?"success":"warning"),t.R7$(),t.SpI(" ",i.isSettled?"Settled":"Unsettled"," ")}}function f(l,r){1&l&&(t.j41(0,"tr")(1,"td",35),t.EFF(2,"No settlement records found"),t.k0s()())}const k=[{path:"",component:(()=>{var l;class r{constructor(e,s,n,o){this.route=e,this.http=s,this.loadingController=n,this.toastController=o,this.allSettlements=[],this.settlements=[],this.selectedItems=new Set,this.selectAll=!1,this.sortStatus="unsettled",this.totalSettledAmount=0,this.totalUnsettledAmount=0,this.totalAdminEarnings=0}ngOnInit(){this.hotelId=this.route.snapshot.paramMap.get("id"),this.loadSettlements()}loadSettlements(){var e=this;return(0,c.A)(function*(){const s=yield e.loadingController.create({message:"Loading settlements..."});yield s.present(),e.http.getPartnerSettlements(e.hotelId).subscribe({next:n=>{const o=Array.isArray(null==n?void 0:n.data)?n.data:[];e.allSettlements=o,e.applyFilters(),e.calculateTotals(),s.dismiss()},error:n=>{console.error("Error loading settlements:",n),e.showToast("Failed to load settlements","danger"),s.dismiss()}})})()}calculateTotals(){this.totalSettledAmount=this.allSettlements.filter(e=>e.isSettled).reduce((e,s)=>e+s.totalPartnerEarning,0),this.totalUnsettledAmount=this.allSettlements.filter(e=>!e.isSettled).reduce((e,s)=>e+s.totalPartnerEarning,0),this.totalAdminEarnings=this.allSettlements.reduce((e,s)=>e+s.adminEarning,0)}onSortStatusChange(e){this.sortStatus=e.detail.value,this.applyFilters(),this.resetSelection()}applyFilters(){this.settlements="all"===this.sortStatus?[...this.allSettlements]:this.allSettlements.filter("settled"===this.sortStatus?e=>e.isSettled:e=>!e.isSettled)}getFilteredSettlements(){return"all"===this.sortStatus?this.settlements:this.settlements.filter(e=>"settled"===this.sortStatus?e.isSettled:!e.isSettled)}onSelectAllChange(e){this.selectAll=e.detail.checked,this.selectAll?this.settlements.filter(s=>!s.isSettled).forEach(s=>this.selectedItems.add(s._id)):this.selectedItems.clear()}onSettlementSelect(e,s){e.detail.checked?this.selectedItems.add(s._id):this.selectedItems.delete(s._id),this.updateSelectAllState()}isSettlementSelected(e){return this.selectedItems.has(e._id)}getSelectedAmount(){return this.allSettlements.filter(e=>this.selectedItems.has(e._id)).reduce((e,s)=>e+s.totalPartnerEarning,0)}submitSettlements(){var e=this;return(0,c.A)(function*(){if(0===e.selectedItems.size)return;const s=yield e.loadingController.create({message:"Processing settlements..."});yield s.present();const n={settlementIds:Array.from(e.selectedItems)};var o;e.http.markPartnerSettlemetsPaid(n.settlementIds).subscribe({next:(o=(0,c.A)(function*(u){yield s.dismiss(),e.showToast("Settlements marked successfully","success"),e.selectedItems.clear(),e.selectAll=!1,e.loadSettlements()}),function(E){return o.apply(this,arguments)}),error:function(){var o=(0,c.A)(function*(u){yield s.dismiss(),console.error("Error marking settlements:",u),e.showToast("Failed to mark settlements","danger")});return function(E){return o.apply(this,arguments)}}()})})()}resetSelection(){this.selectedItems.clear(),this.selectAll=!1}updateSelectAllState(){const e=this.settlements.filter(s=>!s.isSettled).length;this.selectAll=e>0&&this.selectedItems.size===e}showToast(e,s){var n=this;return(0,c.A)(function*(){yield(yield n.toastController.create({message:e,duration:2e3,color:s,position:"top"})).present()})()}}return(l=r).\u0275fac=function(e){return new(e||l)(t.rXU(m.nX),t.rXU(F.k),t.rXU(a.Xi),t.rXU(a.K_))},l.\u0275cmp=t.VBU({type:l,selectors:[["app-settle"]],decls:82,vars:12,consts:[[1,"ion-no-border",3,"translucent"],["slot","start"],["defaultHref","/folder/auth/partners/view"],["slot","end"],["color","primary",3,"click","disabled"],["name","checkmark-circle-outline","slot","start"],[1,"ion-padding",3,"fullscreen"],[1,"row","g-4","mb-4"],[1,"col-md-3"],[1,"card","shadow-sm","border-0"],[1,"card-body"],[1,"text-muted","mb-2"],[1,"mb-0","text-success"],[1,"mb-0","text-warning"],[1,"mb-0","text-primary"],[1,"mb-0","text-info"],[1,"card-header","bg-white","border-0","d-flex","justify-content-between","align-items-center"],["name","list-outline",1,"me-2"],[1,"d-flex","align-items-center","gap-3"],["interface","action-sheet","placeholder","Filter by status",3,"ionChange","value"],["value","all"],["value","settled"],["value","unsettled"],[1,"d-flex","align-items-center"],["labelPlacement","end",3,"ionChange","checked"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[2,"width","50px"],[3,"ionChange","checked"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ionChange","checked","disabled"],[3,"color"],["colspan","9",1,"text-center","py-4"]],template:function(e,s){if(1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-back-button",2),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Settlements"),t.k0s(),t.j41(6,"ion-buttons",3)(7,"ion-button",4),t.bIt("click",function(){return s.submitSettlements()}),t.nrm(8,"ion-icon",5),t.EFF(9," Mark Selected as Settled "),t.k0s()()()(),t.j41(10,"ion-content",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"h6",11),t.EFF(16,"Total Settled Amount"),t.k0s(),t.j41(17,"h3",12),t.EFF(18),t.k0s()()()(),t.j41(19,"div",8)(20,"div",9)(21,"div",10)(22,"h6",11),t.EFF(23,"Total Unsettled Amount"),t.k0s(),t.j41(24,"h3",13),t.EFF(25),t.k0s()()()(),t.j41(26,"div",8)(27,"div",9)(28,"div",10)(29,"h6",11),t.EFF(30,"Total Admin Earnings"),t.k0s(),t.j41(31,"h3",14),t.EFF(32),t.k0s()()()(),t.j41(33,"div",8)(34,"div",9)(35,"div",10)(36,"h6",11),t.EFF(37,"Selected Amount"),t.k0s(),t.j41(38,"h3",15),t.EFF(39),t.k0s()()()()(),t.j41(40,"div",9)(41,"div",16)(42,"h5",14),t.nrm(43,"ion-icon",17),t.EFF(44," Settlement Details "),t.k0s(),t.j41(45,"div",18)(46,"ion-select",19),t.bIt("ionChange",function(o){return s.onSortStatusChange(o)}),t.j41(47,"ion-select-option",20),t.EFF(48,"All"),t.k0s(),t.j41(49,"ion-select-option",21),t.EFF(50,"Settled"),t.k0s(),t.j41(51,"ion-select-option",22),t.EFF(52,"Unsettled"),t.k0s()(),t.j41(53,"div",23)(54,"ion-checkbox",24),t.bIt("ionChange",function(o){return s.onSelectAllChange(o)}),t.EFF(55," Select All "),t.k0s()()()(),t.j41(56,"div",25)(57,"div",26)(58,"table",27)(59,"thead",28)(60,"tr")(61,"th",29)(62,"ion-checkbox",30),t.bIt("ionChange",function(o){return s.onSelectAllChange(o)}),t.k0s()(),t.j41(63,"th"),t.EFF(64,"Order ID"),t.k0s(),t.j41(65,"th"),t.EFF(66,"Dish"),t.k0s(),t.j41(67,"th"),t.EFF(68,"Quantity"),t.k0s(),t.j41(69,"th"),t.EFF(70,"Partner Price"),t.k0s(),t.j41(71,"th"),t.EFF(72,"Admin Earning"),t.k0s(),t.j41(73,"th"),t.EFF(74,"Total Amount"),t.k0s(),t.j41(75,"th"),t.EFF(76,"Date"),t.k0s(),t.j41(77,"th"),t.EFF(78,"Status"),t.k0s()()(),t.j41(79,"tbody"),t.DNE(80,p,21,14,"tr",31)(81,f,3,0,"tr",32),t.k0s()()()()()()),2&e){let n;t.Y8G("translucent",!0),t.R7$(7),t.Y8G("disabled",0===s.selectedItems.size),t.R7$(3),t.Y8G("fullscreen",!0),t.R7$(8),t.SpI("\u20b9",s.totalSettledAmount,""),t.R7$(7),t.SpI("\u20b9",s.totalUnsettledAmount,""),t.R7$(7),t.SpI("\u20b9",s.totalAdminEarnings,""),t.R7$(7),t.SpI("\u20b9",s.getSelectedAmount(),""),t.R7$(7),t.Y8G("value",s.sortStatus),t.R7$(8),t.Y8G("checked",s.selectAll),t.R7$(8),t.Y8G("checked",s.selectAll),t.R7$(18),t.Y8G("ngForOf",s.getFilteredSettlements()),t.R7$(),t.Y8G("ngIf",!(null!=(n=s.getFilteredSettlements())&&n.length))}},dependencies:[h.Sq,h.bT,a.In,a.Jm,a.QW,a.eY,a.W9,a.eU,a.iq,a.Nm,a.Ip,a.BC,a.ai,a.hB,a.Je,a.el,h.vh]}),r})()}];let b=(()=>{var l;class r{}return(l=r).\u0275fac=function(e){return new(e||l)},l.\u0275mod=t.$C({type:l}),l.\u0275inj=t.G2t({imports:[m.iI.forChild(k),m.iI]}),r})(),v=(()=>{var l;class r{}return(l=r).\u0275fac=function(e){return new(e||l)},l.\u0275mod=t.$C({type:l}),l.\u0275inj=t.G2t({imports:[h.MD,g.YN,a.bv,b]}),r})()}}]);