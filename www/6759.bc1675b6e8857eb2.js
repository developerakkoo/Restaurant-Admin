"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6759],{6759:(w,h,r)=>{r.r(h),r.d(h,{PincodePageModule:()=>T});var p=r(177),y=r(4341),s=r(4488),m=r(8986),g=r(467),b=r(7762),M=r(8359),t=r(4438),C=r(4796),A=r(8490);const F=["map"];function k(i,a){if(1&i){const c=t.RV6();t.j41(0,"ion-item")(1,"ion-label")(2,"h2"),t.EFF(3),t.k0s(),t.j41(4,"p"),t.EFF(5),t.k0s()(),t.j41(6,"ion-button",9),t.bIt("click",function(){const o=t.eBV(c).$implicit,n=t.XpG();return t.Njj(n.deletePincodeWithToast(o._id))}),t.EFF(7,"Delete"),t.k0s()()}if(2&i){const c=a.$implicit;t.R7$(3),t.JRh(c.pincode),t.R7$(2),t.JRh(c.address)}}const L=[{path:"",component:(()=>{var i;class a{constructor(e,o,n,u,l){this.alertController=e,this.auth=o,this.loadingController=n,this.toastController=u,this.data=l,this.radius=1e3,this.savedPincodes=[],this.draggableMarker=null,this.pincodeCacheKey="cachedPincodes",this.subscriptions=new M.yU}ngOnInit(){console.log("PincodePage initialized"),this.getAllPincodes()}ngAfterViewInit(){this.getCurrentLocation()}ngOnDestroy(){this.subscriptions.unsubscribe(),this.map&&(google.maps.event.clearInstanceListeners(this.map),this.map=null),this.draggableMarker&&(google.maps.event.clearInstanceListeners(this.draggableMarker),this.draggableMarker.setMap(null),this.draggableMarker=null),this.savedPincodes.forEach(e=>{google.maps.event.clearInstanceListeners(e),e.setMap(null)}),this.savedPincodes=[],this.circle&&(google.maps.event.clearInstanceListeners(this.circle),this.circle.setMap(null),this.circle=null)}showToast(e){var o=this;return(0,g.A)(function*(){(yield o.toastController.create({message:e,duration:2e3,position:"bottom"})).present()})()}getCurrentLocation(){var e=this;return(0,g.A)(function*(){try{const o={maximumAge:3e3,timeout:1e4,enableHighAccuracy:!0},n=yield b.L.getCurrentPosition(o);e.location=n,e.loadMap()}catch(o){console.error(o)}})()}loadMap(){const o={center:new google.maps.LatLng(this.location.coords.latitude,this.location.coords.longitude),zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.mapElement.nativeElement,o),this.geocoder=new google.maps.Geocoder}createDraggableMarker(){var e=this;if(this.draggableMarker)return;const o=this.map.getCenter();this.draggableMarker=new google.maps.Marker({position:o,map:this.map,draggable:!0,icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),google.maps.event.addListener(this.draggableMarker,"dragend",(0,g.A)(function*(){const n=e.draggableMarker.getPosition(),u=n.lat(),l=n.lng(),d=yield e.getAddressFromLatLng(u,l);d&&e.confirmAddPincode(d)}))}confirmAddPincode(e){var o=this;return(0,g.A)(function*(){yield(yield o.alertController.create({header:"Add Pincode",message:`Do you want to add this location?\nAddress: ${e.address}\nPincode:${e.pincode}`,buttons:[{text:"Cancel",role:"cancel"},{text:"Add",handler:()=>{o.addPincode(e)}}]})).present()})()}getAddressFromLatLng(e,o){return new Promise((n,u)=>{this.geocoder.geocode({location:{lat:e,lng:o}},(d,P)=>{if("OK"===P&&d[0]){const j=d[0].formatted_address;let f="";for(const v of d[0].address_components)if(v.types.includes("postal_code")){f=v.long_name;break}n({pincode:f,address:j,lat:e,lng:o})}else console.error("Geocoder failed due to: "+P),n(null)})})}addPincode(e){console.log("Pincode added:",e),this.createCircle(e.lat,e.lng),this.subscriptions.add(this.auth.addPincode(e).subscribe({next:o=>{console.log("Pincode saved to server:",o),this.showToast("Pincode added successfully"),this.getAllPincodes()},error:o=>{console.error("Error saving pincode to server:",o),this.showToast("Error adding pincode")}}))}getAllPincodes(){var e=this;return(0,g.A)(function*(){const o=yield e.loadingController.create({message:"Loading pincodes..."});yield o.present(),e.subscriptions.add(e.auth.getAllPincode().subscribe({next:n=>{console.log("response"+n),console.log(n.data),e.savedPincodes=n.data,e.savedPincodes=n.data,o.dismiss()},error:n=>{console.error("Error fetching pincodes:",n),e.showToast("Error loading pincodes"),o.dismiss()}}))})()}cachePincodes(e){var o=this;return(0,g.A)(function*(){try{yield o.data.set(o.pincodeCacheKey,e),console.log("Pincodes cached successfully")}catch(n){console.error("Error caching pincodes:",n)}})()}getCachedPincodes(){var e=this;return(0,g.A)(function*(){try{return(yield e.data.get(e.pincodeCacheKey))||null}catch(o){return console.error("Error retrieving cached pincodes:",o),null}})()}deletePincodeWithToast(e){var o=this;return(0,g.A)(function*(){var u;console.log("pincode to delete:",e),yield(yield o.alertController.create({header:"Delete Pincode",message:"Are you sure you want to delete this pincode?",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:(u=(0,g.A)(function*(){const l=yield o.loadingController.create({message:"Deleting pincode..."});yield l.present(),o.subscriptions.add(o.auth.deletePincode(e).subscribe({next:d=>{console.log("Pincode deleted:",d),l.dismiss(),o.getAllPincodes(),o.showToast("Pincode deleted successfully")},error:d=>{console.error("Error deleting pincode:",d),o.showToast("Error deleting pincode"),l.dismiss()}}))}),function(){return u.apply(this,arguments)})}]})).present()})()}createCircle(e,o){this.circle&&this.circle.setMap(null);const n=new google.maps.LatLng(e,o);this.circle=new google.maps.Circle({center:n,radius:this.radius,map:this.map,fillColor:"#FF0000",fillOpacity:.35,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2}),this.map.setCenter(n)}}return(i=a).\u0275fac=function(e){return new(e||i)(t.rXU(s.hG),t.rXU(C.u),t.rXU(s.Xi),t.rXU(s.K_),t.rXU(A.u))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-pincode"]],viewQuery:function(e,o){if(1&e&&t.GBs(F,5),2&e){let n;t.mGM(n=t.lsd())&&(o.mapElement=n.first)}},decls:14,vars:3,consts:[["map",""],[1,"ion-no-border",3,"translucent"],["slot","end"],[3,"click"],[3,"fullscreen"],[2,"display","flex","flex-direction","column","height","100%"],["id","map",2,"flex","1","height","50%"],[2,"flex","1","overflow-y","auto","padding","10px"],[4,"ngFor","ngForOf"],["color","danger","slot","end",3,"click"]],template:function(e,o){if(1&e){const n=t.RV6();t.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Pincode Setup"),t.k0s(),t.j41(4,"ion-buttons",2)(5,"ion-button",3),t.bIt("click",function(){return t.eBV(n),t.Njj(o.createDraggableMarker())}),t.EFF(6,"Add Pincode"),t.k0s()()()(),t.j41(7,"ion-content",4)(8,"div",5),t.nrm(9,"div",6,0),t.j41(11,"div",7)(12,"ion-list"),t.DNE(13,k,8,2,"ion-item",8),t.k0s()()()()}2&e&&(t.Y8G("translucent",!0),t.R7$(7),t.Y8G("fullscreen",!0),t.R7$(6),t.Y8G("ngForOf",o.savedPincodes))},dependencies:[p.Sq,s.Jm,s.QW,s.W9,s.eU,s.uz,s.he,s.nf,s.BC,s.ai],styles:["ion-content[_ngcontent-%COMP%]{--background: transparent}"]}),a})()}];let E=(()=>{var i;class a{}return(i=a).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[m.iI.forChild(L),m.iI]}),a})(),T=(()=>{var i;class a{}return(i=a).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[p.MD,y.YN,s.bv,E]}),a})()}}]);