"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9913],{9913:(j,g,d)=>{d.r(g),d.d(g,{SettlePageModule:()=>v});var u=d(177),S=d(4341),o=d(4488),m=d(8986),c=d(467),e=d(4438),F=d(6722);function f(s,a){if(1&s){const l=e.RV6();e.j41(0,"tr")(1,"td")(2,"ion-checkbox",33),e.bIt("ionChange",function(n){const i=e.eBV(l).$implicit,r=e.XpG();return e.Njj(r.onSettlementSelect(n,i))}),e.k0s()(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td"),e.EFF(16),e.nI1(17,"date"),e.k0s(),e.j41(18,"td")(19,"ion-badge",34),e.EFF(20),e.k0s()()()}if(2&s){const l=a.$implicit,t=e.XpG();e.R7$(2),e.Y8G("checked",t.isSettlementSelected(l))("disabled",l.isSettled),e.R7$(2),e.JRh(l.orderId.orderId),e.R7$(2),e.JRh(l.dishId.name),e.R7$(2),e.JRh(l.quantity),e.R7$(2),e.SpI("\u20b9",l.partnerPrice,""),e.R7$(2),e.SpI("\u20b9",l.adminEarning,""),e.R7$(2),e.SpI("\u20b9",l.totalPartnerEarning,""),e.R7$(2),e.JRh(e.i5U(17,11,l.createdAt,"medium")),e.R7$(3),e.Y8G("color",l.isSettled?"success":"warning"),e.R7$(),e.SpI(" ",l.isSettled?"Settled":"Unsettled"," ")}}function p(s,a){1&s&&(e.j41(0,"tr")(1,"td",35),e.EFF(2,"No settlement records found"),e.k0s()())}const k=[{path:"",component:(()=>{var s;class a{constructor(t,n,i,r){this.route=t,this.http=n,this.loadingController=i,this.toastController=r,this.settlements=[],this.selectedItems=new Set,this.selectAll=!1,this.sortStatus="all",this.totalSettledAmount=0,this.totalUnsettledAmount=0,this.totalAdminEarnings=0}ngOnInit(){this.hotelId=this.route.snapshot.paramMap.get("id"),this.loadSettlements()}loadSettlements(){var t=this;return(0,c.A)(function*(){const n=yield t.loadingController.create({message:"Loading settlements..."});yield n.present(),t.http.getPartnerSettlements(t.hotelId,!0).subscribe({next:i=>{t.settlements=i.data,t.calculateTotals(),n.dismiss()},error:i=>{console.error("Error loading settlements:",i),t.showToast("Failed to load settlements","danger"),n.dismiss()}})})()}calculateTotals(){this.totalSettledAmount=this.settlements.filter(t=>t.isSettled).reduce((t,n)=>t+n.totalPartnerEarning,0),this.totalUnsettledAmount=this.settlements.filter(t=>!t.isSettled).reduce((t,n)=>t+n.totalPartnerEarning,0),this.totalAdminEarnings=this.settlements.reduce((t,n)=>t+n.adminEarning,0)}onSortStatusChange(t){this.sortStatus=t.detail.value}getFilteredSettlements(){return"all"===this.sortStatus?this.settlements:this.settlements.filter(t=>"settled"===this.sortStatus?t.isSettled:!t.isSettled)}onSelectAllChange(t){this.selectAll=t.detail.checked,this.selectAll?this.getFilteredSettlements().forEach(n=>{n.isSettled||this.selectedItems.add(n._id)}):this.selectedItems.clear()}onSettlementSelect(t,n){t.detail.checked?this.selectedItems.add(n._id):this.selectedItems.delete(n._id),this.selectAll=this.selectedItems.size===this.getFilteredSettlements().length}isSettlementSelected(t){return this.selectedItems.has(t._id)}getSelectedAmount(){return this.settlements.filter(t=>this.selectedItems.has(t._id)).reduce((t,n)=>t+n.totalPartnerEarning,0)}submitSettlements(){var t=this;return(0,c.A)(function*(){if(0===t.selectedItems.size)return;const n=yield t.loadingController.create({message:"Processing settlements..."});yield n.present();const i={settlementIds:Array.from(t.selectedItems)};var r;t.http.markPartnerSettlemetsPaid(i.settlementIds).subscribe({next:(r=(0,c.A)(function*(h){yield n.dismiss(),t.showToast("Settlements marked successfully","success"),t.selectedItems.clear(),t.selectAll=!1,t.loadSettlements()}),function(E){return r.apply(this,arguments)}),error:function(){var r=(0,c.A)(function*(h){yield n.dismiss(),console.error("Error marking settlements:",h),t.showToast("Failed to mark settlements","danger")});return function(E){return r.apply(this,arguments)}}()})})()}showToast(t,n){var i=this;return(0,c.A)(function*(){yield(yield i.toastController.create({message:t,duration:2e3,color:n,position:"top"})).present()})()}}return(s=a).\u0275fac=function(t){return new(t||s)(e.rXU(m.nX),e.rXU(F.k),e.rXU(o.Xi),e.rXU(o.K_))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-settle"]],decls:82,vars:12,consts:[[1,"ion-no-border",3,"translucent"],["slot","start"],["defaultHref","/folder/auth/partners/view"],["slot","end"],["color","primary",3,"click","disabled"],["name","checkmark-circle-outline","slot","start"],[1,"ion-padding",3,"fullscreen"],[1,"row","g-4","mb-4"],[1,"col-md-3"],[1,"card","shadow-sm","border-0"],[1,"card-body"],[1,"text-muted","mb-2"],[1,"mb-0","text-success"],[1,"mb-0","text-warning"],[1,"mb-0","text-primary"],[1,"mb-0","text-info"],[1,"card-header","bg-white","border-0","d-flex","justify-content-between","align-items-center"],["name","list-outline",1,"me-2"],[1,"d-flex","align-items-center","gap-3"],["interface","action-sheet","placeholder","Filter by status",3,"ionChange","value"],["value","all"],["value","settled"],["value","unsettled"],[1,"d-flex","align-items-center"],["labelPlacement","end",3,"ionChange","checked"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[2,"width","50px"],[3,"ionChange","checked"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"ionChange","checked","disabled"],[3,"color"],["colspan","9",1,"text-center","py-4"]],template:function(t,n){if(1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Settlements"),e.k0s(),e.j41(6,"ion-buttons",3)(7,"ion-button",4),e.bIt("click",function(){return n.submitSettlements()}),e.nrm(8,"ion-icon",5),e.EFF(9," Mark Selected as Settled "),e.k0s()()()(),e.j41(10,"ion-content",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"h6",11),e.EFF(16,"Total Settled Amount"),e.k0s(),e.j41(17,"h3",12),e.EFF(18),e.k0s()()()(),e.j41(19,"div",8)(20,"div",9)(21,"div",10)(22,"h6",11),e.EFF(23,"Total Unsettled Amount"),e.k0s(),e.j41(24,"h3",13),e.EFF(25),e.k0s()()()(),e.j41(26,"div",8)(27,"div",9)(28,"div",10)(29,"h6",11),e.EFF(30,"Total Admin Earnings"),e.k0s(),e.j41(31,"h3",14),e.EFF(32),e.k0s()()()(),e.j41(33,"div",8)(34,"div",9)(35,"div",10)(36,"h6",11),e.EFF(37,"Selected Amount"),e.k0s(),e.j41(38,"h3",15),e.EFF(39),e.k0s()()()()(),e.j41(40,"div",9)(41,"div",16)(42,"h5",14),e.nrm(43,"ion-icon",17),e.EFF(44," Settlement Details "),e.k0s(),e.j41(45,"div",18)(46,"ion-select",19),e.bIt("ionChange",function(r){return n.onSortStatusChange(r)}),e.j41(47,"ion-select-option",20),e.EFF(48,"All"),e.k0s(),e.j41(49,"ion-select-option",21),e.EFF(50,"Settled"),e.k0s(),e.j41(51,"ion-select-option",22),e.EFF(52,"Unsettled"),e.k0s()(),e.j41(53,"div",23)(54,"ion-checkbox",24),e.bIt("ionChange",function(r){return n.onSelectAllChange(r)}),e.EFF(55," Select All "),e.k0s()()()(),e.j41(56,"div",25)(57,"div",26)(58,"table",27)(59,"thead",28)(60,"tr")(61,"th",29)(62,"ion-checkbox",30),e.bIt("ionChange",function(r){return n.onSelectAllChange(r)}),e.k0s()(),e.j41(63,"th"),e.EFF(64,"Order ID"),e.k0s(),e.j41(65,"th"),e.EFF(66,"Dish"),e.k0s(),e.j41(67,"th"),e.EFF(68,"Quantity"),e.k0s(),e.j41(69,"th"),e.EFF(70,"Partner Price"),e.k0s(),e.j41(71,"th"),e.EFF(72,"Admin Earning"),e.k0s(),e.j41(73,"th"),e.EFF(74,"Total Amount"),e.k0s(),e.j41(75,"th"),e.EFF(76,"Date"),e.k0s(),e.j41(77,"th"),e.EFF(78,"Status"),e.k0s()()(),e.j41(79,"tbody"),e.DNE(80,f,21,14,"tr",31)(81,p,3,0,"tr",32),e.k0s()()()()()()),2&t){let i;e.Y8G("translucent",!0),e.R7$(7),e.Y8G("disabled",0===n.selectedItems.size),e.R7$(3),e.Y8G("fullscreen",!0),e.R7$(8),e.SpI("\u20b9",n.totalSettledAmount,""),e.R7$(7),e.SpI("\u20b9",n.totalUnsettledAmount,""),e.R7$(7),e.SpI("\u20b9",n.totalAdminEarnings,""),e.R7$(7),e.SpI("\u20b9",n.getSelectedAmount(),""),e.R7$(7),e.Y8G("value",n.sortStatus),e.R7$(8),e.Y8G("checked",n.selectAll),e.R7$(8),e.Y8G("checked",n.selectAll),e.R7$(18),e.Y8G("ngForOf",n.getFilteredSettlements()),e.R7$(),e.Y8G("ngIf",!(null!=(i=n.getFilteredSettlements())&&i.length))}},dependencies:[u.Sq,u.bT,o.In,o.Jm,o.QW,o.eY,o.W9,o.eU,o.iq,o.Nm,o.Ip,o.BC,o.ai,o.hB,o.Je,o.el,u.vh]}),a})()}];let b=(()=>{var s;class a{}return(s=a).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[m.iI.forChild(k),m.iI]}),a})(),v=(()=>{var s;class a{}return(s=a).\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.$C({type:s}),s.\u0275inj=e.G2t({imports:[u.MD,S.YN,o.bv,b]}),a})()}}]);