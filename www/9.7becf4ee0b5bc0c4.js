"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9],{9:(B,F,h)=>{h.r(F),h.d(F,{ViewPageModule:()=>j});var g=h(177),y=h(4341),r=h(4488),u=h(8986),m=h(467),e=h(4438),E=h(6722);function f(i,d){if(1&i){const l=e.RV6();e.j41(0,"tr")(1,"td")(2,"ion-checkbox",31),e.bIt("ionChange",function(t){const o=e.eBV(l).$implicit,s=e.XpG();return e.Njj(s.onEarningSelect(t,o))}),e.k0s()(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"td")(11,"ion-badge",35),e.EFF(12),e.k0s()()()}if(2&i){const l=d.$implicit,n=e.XpG();e.R7$(2),e.Y8G("checked",n.isEarningSelected(l)),e.R7$(2),e.SpI("Order #",l.orderId,""),e.R7$(2),e.SpI("\u20b9",l.amount,""),e.R7$(2),e.JRh(e.i5U(9,6,l.date,"medium")),e.R7$(3),e.Y8G("color",l.isSettled?"success":"warning"),e.R7$(),e.SpI(" ",l.isSettled?"Paid":"Unpaid"," ")}}function p(i,d){1&i&&(e.j41(0,"tr")(1,"td",36),e.EFF(2,"No commission records found"),e.k0s()())}function k(i,d){if(1&i){const l=e.RV6();e.j41(0,"div",37)(1,"div",20)(2,"div",38),e.EFF(3),e.k0s(),e.j41(4,"ion-button",39),e.bIt("click",function(){e.eBV(l);const t=e.XpG();return e.Njj(t.markSettlement())}),e.nrm(5,"ion-icon",40),e.EFF(6," Mark Settlement "),e.k0s()()()}if(2&i){const l=e.XpG();e.R7$(3),e.SpI(" Selected Amount: \u20b9",l.getSelectedAmount()," "),e.R7$(),e.Y8G("disabled",!l.selectedEarnings.length)}}const S=[{path:"",component:(()=>{var i;class d{constructor(n,t,o,s){this.route=n,this.http=t,this.alertController=o,this.toastController=s,this.deliveryBoy={},this.earnings=[],this.ordersSettled=[],this.selectedEarnings=[],this.selectAll=!1,this.sortStatus="all",this.totalEarnings=0,this.totalOrdersSettled=0,this.totalOrdersUnsettled=0,this.totalEarningsSettled=0,this.totalEarningsUnsettled=0,this.ordersUnsettled=[],this.totalOrdersDelivered=0}ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),console.log("Delivery Boy ID:",this.id)}ionViewDidEnter(){this.getDeliveryBoy(this.id),this.getDeliveryBoyEarnings(this.id)}getDeliveryBoy(n){this.http.getDeliveryBoy(n).subscribe(t=>{console.log(t),this.deliveryBoy=t.data[0]},t=>{console.log(t)})}getDeliveryBoyEarnings(n,t="",o=""){this.http.getDeliveryBoyEarnings(n,t,o).subscribe({next:s=>{console.log("Delivery Boy Earnings"),s&&(this.earnings=s,this.totalEarnings=s.reduce((a,c)=>a+(c.amount||0),0),this.ordersSettled=s.filter(a=>a.isSettled),this.totalOrdersSettled=s.filter(a=>a.isSettled).length,this.totalEarningsSettled=this.ordersSettled.reduce((a,c)=>a+(c.amount||0),0),this.totalOrdersDelivered=s.length,this.ordersUnsettled=s.filter(a=>!a.isSettled),this.totalOrdersUnsettled=this.ordersUnsettled.length,this.totalEarningsUnsettled=this.ordersUnsettled.reduce((a,c)=>a+(c.amount||0),0))},error:s=>{console.error("Error fetching delivery boy earnings:",s)}})}getDeliveryBoyOrdersSettled(n,t="",o=""){this.http.getDeliveryBoyOrdersSettled(n,t,o).subscribe(s=>{console.log("Delivery Boy Orders Settled"),console.log(s)})}onSortStatusChange(n){this.sortStatus=n.detail.value}getFilteredEarnings(){return"all"===this.sortStatus?this.earnings:this.earnings.filter(n=>"paid"===this.sortStatus?n.isSettled:!n.isSettled)}onSelectAllChange(n){this.selectAll=n.detail.checked,this.selectedEarnings=this.selectAll?[...this.getFilteredEarnings()]:[]}onEarningSelect(n,t){n.detail.checked?this.selectedEarnings.push(t):this.selectedEarnings=this.selectedEarnings.filter(o=>o._id!==t._id),this.selectAll=this.selectedEarnings.length===this.getFilteredEarnings().length}isEarningSelected(n){return this.selectedEarnings.some(t=>t._id===n._id)}getSelectedAmount(){return this.selectedEarnings.reduce((n,t)=>n+(t.amount||0),0)}markSettlement(){var n=this;return(0,m.A)(function*(){0!==n.selectedEarnings.length&&(yield(yield n.alertController.create({header:"Confirm Settlement",message:`Are you sure you want to mark settlement for ${n.selectedEarnings.length} orders?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{n.processSettlement()}}]})).present())})()}processSettlement(){var n=this;const o=`Settlement marked on ${(new Date).toLocaleString()}`,s={driverId:this.id,earningIds:this.selectedEarnings.map(a=>a._id),note:o};var a;console.log(s),this.http.markDeliveryBoyEarningsSettled(s).subscribe({next:(a=(0,m.A)(function*(c){yield(yield n.toastController.create({message:"Settlement marked successfully",duration:2e3,color:"success",position:"top"})).present(),n.getDeliveryBoyEarnings(n.id),n.selectedEarnings=[],n.selectAll=!1}),function(v){return a.apply(this,arguments)}),error:function(){var a=(0,m.A)(function*(c){yield(yield n.toastController.create({message:"Failed to mark settlement. Please try again.",duration:2e3,color:"danger",position:"top"})).present(),console.error("Settlement error:",c)});return function(v){return a.apply(this,arguments)}}()})}}return(i=d).\u0275fac=function(n){return new(n||i)(e.rXU(u.nX),e.rXU(E.k),e.rXU(r.hG),e.rXU(r.K_))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-view"]],decls:105,vars:19,consts:[[3,"translucent"],["slot","start"],["defaultHref","/folder/auth/delivery-boy"],[1,"ion-padding",3,"fullscreen"],[1,"card","shadow-sm","mb-4"],[1,"card-header","bg-light"],[1,"mb-0"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label","fw-bold"],[1,"form-control-plaintext"],[1,"col-md-3"],[1,"text-center","p-3","border","rounded"],[1,"text-muted","mb-2"],[1,"text-success"],[1,"text-warning"],[1,"card","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-3"],["interface","action-sheet","placeholder","Filter by status",3,"ionChange","value"],["value","all"],["value","paid"],["value","unpaid"],[1,"d-flex","align-items-center"],["labelPlacement","end",3,"ionChange","checked"],[1,"table-responsive"],[1,"table","table-bordered"],[1,"table-light"],[2,"width","50px"],[3,"ionChange","checked"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","d-flex justify-content-end mt-3",4,"ngIf"],[3,"color"],["colspan","5",1,"text-center"],[1,"d-flex","justify-content-end","mt-3"],[1,"alert","alert-info","mb-0"],["color","primary",3,"click","disabled"],["name","checkmark-circle-outline","slot","start"]],template:function(n,t){if(1&n&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Delivery Boy Details"),e.k0s()()(),e.j41(6,"ion-content",3)(7,"div",4)(8,"div",5)(9,"h5",6),e.EFF(10,"Personal Information"),e.k0s()(),e.j41(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"label",11),e.EFF(16,"Name"),e.k0s(),e.j41(17,"p",12),e.EFF(18),e.k0s()()(),e.j41(19,"div",9)(20,"div",10)(21,"label",11),e.EFF(22,"Phone Number"),e.k0s(),e.j41(23,"p",12),e.EFF(24),e.k0s()()(),e.j41(25,"div",9)(26,"div",10)(27,"label",11),e.EFF(28,"Date of Birth"),e.k0s(),e.j41(29,"p",12),e.EFF(30),e.k0s()()(),e.j41(31,"div",9)(32,"div",10)(33,"label",11),e.EFF(34,"Address"),e.k0s(),e.j41(35,"p",12),e.EFF(36),e.k0s()()()()()(),e.j41(37,"div",4)(38,"div",5)(39,"h5",6),e.EFF(40,"Performance Metrics"),e.k0s()(),e.j41(41,"div",7)(42,"div",8)(43,"div",13)(44,"div",14)(45,"h6",15),e.EFF(46,"Total Orders Delivered"),e.k0s(),e.j41(47,"h3",6),e.EFF(48),e.k0s()()(),e.j41(49,"div",13)(50,"div",14)(51,"h6",15),e.EFF(52,"Total Earnings"),e.k0s(),e.j41(53,"h3",6),e.EFF(54),e.k0s()()(),e.j41(55,"div",13)(56,"div",14)(57,"h6",15),e.EFF(58,"Orders Settled"),e.k0s(),e.j41(59,"h3",6),e.EFF(60),e.k0s(),e.j41(61,"small",16),e.EFF(62),e.k0s()()(),e.j41(63,"div",13)(64,"div",14)(65,"h6",15),e.EFF(66,"Orders Unsettled"),e.k0s(),e.j41(67,"h3",6),e.EFF(68),e.k0s(),e.j41(69,"small",17),e.EFF(70),e.k0s()()()()()(),e.j41(71,"div",18)(72,"div",19)(73,"h5",6),e.EFF(74,"Commission Details"),e.k0s(),e.j41(75,"div",20)(76,"ion-select",21),e.bIt("ionChange",function(s){return t.onSortStatusChange(s)}),e.j41(77,"ion-select-option",22),e.EFF(78,"All"),e.k0s(),e.j41(79,"ion-select-option",23),e.EFF(80,"Paid"),e.k0s(),e.j41(81,"ion-select-option",24),e.EFF(82,"Unpaid"),e.k0s()(),e.j41(83,"div",25)(84,"ion-checkbox",26),e.bIt("ionChange",function(s){return t.onSelectAllChange(s)}),e.EFF(85," Select All "),e.k0s()()()(),e.j41(86,"div",7)(87,"div",27)(88,"table",28)(89,"thead",29)(90,"tr")(91,"th",30)(92,"ion-checkbox",31),e.bIt("ionChange",function(s){return t.onSelectAllChange(s)}),e.k0s()(),e.j41(93,"th"),e.EFF(94,"Order Number"),e.k0s(),e.j41(95,"th"),e.EFF(96,"Commission Amount"),e.k0s(),e.j41(97,"th"),e.EFF(98,"Date"),e.k0s(),e.j41(99,"th"),e.EFF(100,"Status"),e.k0s()()(),e.j41(101,"tbody"),e.DNE(102,f,13,9,"tr",32)(103,p,3,0,"tr",33),e.k0s()()(),e.DNE(104,k,7,2,"div",34),e.k0s()()()),2&n){let o;e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(12),e.Lme("",(null==t.deliveryBoy?null:t.deliveryBoy.firstName)||"N/A"," ",(null==t.deliveryBoy?null:t.deliveryBoy.lastName)||"N/A",""),e.R7$(6),e.JRh((null==t.deliveryBoy?null:t.deliveryBoy.phoneNumber)||"N/A"),e.R7$(6),e.JRh((null==t.deliveryBoy?null:t.deliveryBoy.dateOfBirth)||"N/A"),e.R7$(6),e.JRh((null==t.deliveryBoy?null:t.deliveryBoy.address)||"N/A"),e.R7$(12),e.JRh(t.totalOrdersDelivered||0),e.R7$(6),e.SpI("\u20b9",t.totalEarnings||0,""),e.R7$(6),e.JRh(t.totalOrdersSettled||0),e.R7$(2),e.SpI("\u20b9",t.totalEarningsSettled||0,""),e.R7$(6),e.JRh(t.totalOrdersUnsettled||0),e.R7$(2),e.SpI("\u20b9",t.totalEarningsUnsettled||0,""),e.R7$(6),e.Y8G("value",t.sortStatus),e.R7$(8),e.Y8G("checked",t.selectAll),e.R7$(8),e.Y8G("checked",t.selectAll),e.R7$(10),e.Y8G("ngForOf",t.getFilteredEarnings()),e.R7$(),e.Y8G("ngIf",!(null!=(o=t.getFilteredEarnings())&&o.length)),e.R7$(),e.Y8G("ngIf",t.selectedEarnings.length>0)}},dependencies:[g.Sq,g.bT,r.In,r.Jm,r.QW,r.eY,r.W9,r.eU,r.iq,r.Nm,r.Ip,r.BC,r.ai,r.hB,r.Je,r.el,g.vh]}),d})()}];let b=(()=>{var i;class d{}return(i=d).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[u.iI.forChild(S),u.iI]}),d})(),j=(()=>{var i;class d{}return(i=d).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[g.MD,y.YN,r.bv,b]}),d})()}}]);