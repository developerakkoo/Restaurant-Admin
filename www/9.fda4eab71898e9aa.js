"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9],{9:(C,S,m)=>{m.r(S),m.d(S,{ViewPageModule:()=>w});var v=m(177),E=m(4341),a=m(4488),p=m(8986),F=m(467),e=m(4438),f=m(6722);function y(i,d){if(1&i){const l=e.RV6();e.j41(0,"tr")(1,"td")(2,"ion-checkbox",32),e.bIt("ionChange",function(n){const o=e.eBV(l).$implicit,s=e.XpG();return e.Njj(s.onEarningSelect(n,o))}),e.k0s()(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"td")(11,"ion-badge",37),e.EFF(12),e.k0s()()()}if(2&i){const l=d.$implicit,t=e.XpG();e.R7$(2),e.Y8G("checked",t.isEarningSelected(l)),e.R7$(2),e.SpI("Order #",l.orderId,""),e.R7$(2),e.SpI("\u20b9",l.amount,""),e.R7$(2),e.JRh(e.i5U(9,6,l.date,"medium")),e.R7$(3),e.Y8G("color",l.isSettled?"success":"warning"),e.R7$(),e.SpI(" ",l.isSettled?"Paid":"Unpaid"," ")}}function k(i,d){1&i&&(e.j41(0,"tr")(1,"td",38),e.EFF(2,"No commission records found"),e.k0s()())}function j(i,d){if(1&i){const l=e.RV6();e.j41(0,"div",39)(1,"div",21)(2,"div",40),e.EFF(3),e.k0s(),e.j41(4,"ion-button",41),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.markSettlement())}),e.nrm(5,"ion-icon",42),e.EFF(6," Mark Settlement "),e.k0s()()()}if(2&i){const l=e.XpG();e.R7$(3),e.SpI(" Selected Amount: \u20b9",l.getSelectedAmount()," "),e.R7$(),e.Y8G("disabled",!l.selectedEarnings.length)}}function _(i,d){1&i&&(e.j41(0,"div",43),e.nrm(1,"ion-spinner",44),e.k0s())}function b(i,d){if(1&i){const l=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s(),e.j41(8,"td"),e.EFF(9),e.k0s(),e.j41(10,"td"),e.EFF(11),e.k0s(),e.j41(12,"td")(13,"ion-button",47),e.bIt("click",function(){const n=e.eBV(l).$implicit,o=e.XpG(3);return e.Njj(o.viewSettlementDetails(n))}),e.nrm(14,"ion-icon",48),e.EFF(15," View "),e.k0s()()()}if(2&i){const l=d.$implicit;e.R7$(2),e.SpI("#",null==l||null==l._id?null:l._id.slice(-6),""),e.R7$(2),e.JRh(e.i5U(5,5,null==l?null:l.settlementDate,"medium")),e.R7$(3),e.SpI("\u20b9",(null==l?null:l.amountPaid)||0,""),e.R7$(2),e.JRh((null==l||null==l.ordersSettled?null:l.ordersSettled.length)||0),e.R7$(2),e.JRh((null==l?null:l.note)||"\u2014")}}function D(i,d){if(1&i&&(e.j41(0,"div",28)(1,"table",29)(2,"thead",30)(3,"tr")(4,"th"),e.EFF(5,"Settlement ID"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Date"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Amount Paid"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Orders Settled"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Note"),e.k0s(),e.j41(14,"th",46),e.EFF(15,"Action"),e.k0s()()(),e.j41(16,"tbody"),e.DNE(17,b,16,8,"tr",33),e.k0s()()()),2&i){const l=e.XpG(2);e.R7$(17),e.Y8G("ngForOf",l.driverSettlements)}}function $(i,d){1&i&&(e.j41(0,"div",49),e.EFF(1," No settlements recorded yet. "),e.k0s())}function R(i,d){if(1&i&&(e.j41(0,"div"),e.DNE(1,D,18,1,"div",45)(2,$,2,0,"ng-template",null,0,e.C5r),e.k0s()),2&i){const l=e.sdS(3),t=e.XpG();e.R7$(),e.Y8G("ngIf",t.driverSettlements.length)("ngIfElse",l)}}const I=[{path:"",component:(()=>{var i;class d{constructor(t,n,o,s){this.route=t,this.http=n,this.alertController=o,this.toastController=s,this.deliveryBoy={},this.earnings=[],this.ordersSettled=[],this.selectedEarnings=[],this.selectAll=!1,this.sortStatus="all",this.totalEarnings=0,this.totalOrdersSettled=0,this.totalOrdersUnsettled=0,this.totalEarningsSettled=0,this.totalEarningsUnsettled=0,this.ordersUnsettled=[],this.totalOrdersDelivered=0,this.driverSettlements=[],this.settlementSummary={totalSettlements:0,totalAmountPaid:0,averageSettlement:0,lastSettlementDate:null},this.settlementLoading=!1}ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),console.log("Delivery Boy ID:",this.id)}ionViewDidEnter(){this.getDeliveryBoy(this.id),this.getDeliveryBoyEarnings(this.id),this.getDriverSettlementsData(this.id)}getDeliveryBoy(t){this.http.getDeliveryBoy(t).subscribe(n=>{console.log(n),this.deliveryBoy=n.data[0]},n=>{console.log(n)})}getDeliveryBoyEarnings(t,n="",o=""){this.http.getDeliveryBoyEarnings(t,n,o).subscribe({next:s=>{if(console.log("Delivery Boy Earnings"),s){const c=Array.isArray(null==s?void 0:s.data)?s.data:Array.isArray(s)?s:[];this.earnings=c,this.totalEarnings=c.reduce((r,h)=>r+(h.amount||0),0),this.ordersSettled=c.filter(r=>r.isSettled),this.totalOrdersSettled=c.filter(r=>r.isSettled).length,this.totalEarningsSettled=this.ordersSettled.reduce((r,h)=>r+(h.amount||0),0),this.totalOrdersDelivered=c.length,this.ordersUnsettled=c.filter(r=>!r.isSettled),this.totalOrdersUnsettled=this.ordersUnsettled.length,this.totalEarningsUnsettled=this.ordersUnsettled.reduce((r,h)=>r+(h.amount||0),0)}},error:s=>{console.error("Error fetching delivery boy earnings:",s)}})}getDriverSettlementsData(t,n="",o=""){this.settlementLoading=!0,this.http.getDriverSettlements(t,n,o).subscribe({next:s=>{this.settlementLoading=!1;const c=(null==s?void 0:s.data)||s||[],r=Array.isArray(c)?c:[];this.driverSettlements=r.map(u=>({...u,settlementDate:null!=u&&u.settlementDate?new Date(u.settlementDate):null==u?void 0:u.settlementDate}));const h=this.driverSettlements.reduce((u,g)=>u+(g.amountPaid||0),0);this.settlementSummary={totalSettlements:this.driverSettlements.length,totalAmountPaid:h,averageSettlement:this.driverSettlements.length?h/this.driverSettlements.length:0,lastSettlementDate:this.driverSettlements.length?this.driverSettlements[0].settlementDate:null}},error:s=>{this.settlementLoading=!1,console.error("Error fetching driver settlements:",s)}})}onSortStatusChange(t){this.sortStatus=t.detail.value}getFilteredEarnings(){const t=Array.isArray(this.earnings)?this.earnings:[];return"all"===this.sortStatus?t:t.filter(n=>"paid"===this.sortStatus?n.isSettled:!n.isSettled)}onSelectAllChange(t){this.selectAll=t.detail.checked,this.selectedEarnings=this.selectAll?[...this.getFilteredEarnings()]:[]}onEarningSelect(t,n){t.detail.checked?this.selectedEarnings.push(n):this.selectedEarnings=this.selectedEarnings.filter(o=>o._id!==n._id),this.selectAll=this.selectedEarnings.length===this.getFilteredEarnings().length}isEarningSelected(t){return this.selectedEarnings.some(n=>n._id===t._id)}getSelectedAmount(){return this.selectedEarnings.reduce((t,n)=>t+(n.amount||0),0)}markSettlement(){var t=this;return(0,F.A)(function*(){0!==t.selectedEarnings.length&&(yield(yield t.alertController.create({header:"Confirm Settlement",message:`Are you sure you want to mark settlement for ${t.selectedEarnings.length} orders?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{t.processSettlement()}}]})).present())})()}processSettlement(){var t=this;const o=`Settlement marked on ${(new Date).toLocaleString()}`,s={driverId:this.id,earningIds:this.selectedEarnings.map(c=>c._id),note:o};var c;console.log(s),this.http.markDeliveryBoyEarningsSettled(s).subscribe({next:(c=(0,F.A)(function*(r){yield(yield t.toastController.create({message:"Settlement marked successfully",duration:2e3,color:"success",position:"top"})).present(),t.getDeliveryBoyEarnings(t.id),t.getDriverSettlementsData(t.id),t.selectedEarnings=[],t.selectAll=!1}),function(h){return c.apply(this,arguments)}),error:function(){var c=(0,F.A)(function*(r){yield(yield t.toastController.create({message:"Failed to mark settlement. Please try again.",duration:2e3,color:"danger",position:"top"})).present(),console.error("Settlement error:",r)});return function(h){return c.apply(this,arguments)}}()})}viewSettlementDetails(t){var n=this;return(0,F.A)(function*(){const o=(null==t?void 0:t.ordersSettled)||[],s=o.length?o.map((r,h)=>{var u;const g=(null==r?void 0:r.orderId)||{};return`${h+1}. Order #${(null==g?void 0:g.orderId)||(null==r?void 0:r.orderId)||"N/A"} (${(null==g||null===(u=g.hotelId)||void 0===u?void 0:u.hotelName)||"N/A"}) - \u20b9${(null==r?void 0:r.amount)||0}`}).join("<br>"):"No orders included in this settlement.";yield(yield n.alertController.create({header:"Settlement Details",message:`\n        <p><strong>Date:</strong> ${null!=t&&t.settlementDate?new Date(t.settlementDate).toLocaleString():"N/A"}</p>\n        <p><strong>Amount Paid:</strong> \u20b9${(null==t?void 0:t.amountPaid)||0}</p>\n        <p><strong>Orders Settled:</strong> ${o.length}</p>\n        ${null!=t&&t.note?`<p><strong>Note:</strong> ${t.note}</p>`:""}\n        <div style="text-align:left;margin-top:10px">\n          <p><strong>Orders:</strong></p>\n          <div style="font-size: 0.9rem; line-height: 1.4;">${s}</div>\n        </div>\n      `,buttons:["Close"]})).present()})()}}return(i=d).\u0275fac=function(t){return new(t||i)(e.rXU(p.nX),e.rXU(f.k),e.rXU(a.hG),e.rXU(a.K_))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-view"]],decls:145,vars:34,consts:[["noSettlements",""],[3,"translucent"],["slot","start"],["defaultHref","/folder/auth/delivery-boy"],[1,"ion-padding",3,"fullscreen"],[1,"card","shadow-sm","mb-4"],[1,"card-header","bg-light"],[1,"mb-0"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"mb-3"],[1,"form-label","fw-bold"],[1,"form-control-plaintext"],[1,"col-md-3"],[1,"text-center","p-3","border","rounded"],[1,"text-muted","mb-2"],[1,"text-success"],[1,"text-warning"],[1,"card","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"d-flex","align-items-center","gap-3"],["interface","action-sheet","placeholder","Filter by status",3,"ionChange","value"],["value","all"],["value","paid"],["value","unpaid"],[1,"d-flex","align-items-center"],["labelPlacement","end",3,"ionChange","checked"],[1,"table-responsive"],[1,"table","table-bordered"],[1,"table-light"],[2,"width","50px"],[3,"ionChange","checked"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","d-flex justify-content-end mt-3",4,"ngIf"],["class","text-center my-4",4,"ngIf"],[3,"color"],["colspan","5",1,"text-center"],[1,"d-flex","justify-content-end","mt-3"],[1,"alert","alert-info","mb-0"],["color","primary",3,"click","disabled"],["name","checkmark-circle-outline","slot","start"],[1,"text-center","my-4"],["name","crescent"],["class","table-responsive",4,"ngIf","ngIfElse"],[2,"width","120px"],["size","small","fill","clear",3,"click"],["slot","start","name","information-circle-outline"],[1,"text-center","text-muted","py-4"]],template:function(t,n){if(1&t&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Delivery Boy Details"),e.k0s()()(),e.j41(6,"ion-content",4)(7,"div",5)(8,"div",6)(9,"h5",7),e.EFF(10,"Personal Information"),e.k0s()(),e.j41(11,"div",8)(12,"div",9)(13,"div",10)(14,"div",11)(15,"label",12),e.EFF(16,"Name"),e.k0s(),e.j41(17,"p",13),e.EFF(18),e.k0s()()(),e.j41(19,"div",10)(20,"div",11)(21,"label",12),e.EFF(22,"Phone Number"),e.k0s(),e.j41(23,"p",13),e.EFF(24),e.k0s()()(),e.j41(25,"div",10)(26,"div",11)(27,"label",12),e.EFF(28,"Date of Birth"),e.k0s(),e.j41(29,"p",13),e.EFF(30),e.k0s()()(),e.j41(31,"div",10)(32,"div",11)(33,"label",12),e.EFF(34,"Address"),e.k0s(),e.j41(35,"p",13),e.EFF(36),e.k0s()()()()()(),e.j41(37,"div",5)(38,"div",6)(39,"h5",7),e.EFF(40,"Performance Metrics"),e.k0s()(),e.j41(41,"div",8)(42,"div",9)(43,"div",14)(44,"div",15)(45,"h6",16),e.EFF(46,"Total Orders Delivered"),e.k0s(),e.j41(47,"h3",7),e.EFF(48),e.k0s()()(),e.j41(49,"div",14)(50,"div",15)(51,"h6",16),e.EFF(52,"Total Earnings"),e.k0s(),e.j41(53,"h3",7),e.EFF(54),e.k0s()()(),e.j41(55,"div",14)(56,"div",15)(57,"h6",16),e.EFF(58,"Orders Settled"),e.k0s(),e.j41(59,"h3",7),e.EFF(60),e.k0s(),e.j41(61,"small",17),e.EFF(62),e.k0s()()(),e.j41(63,"div",14)(64,"div",15)(65,"h6",16),e.EFF(66,"Orders Unsettled"),e.k0s(),e.j41(67,"h3",7),e.EFF(68),e.k0s(),e.j41(69,"small",18),e.EFF(70),e.k0s()()()()()(),e.j41(71,"div",19)(72,"div",20)(73,"h5",7),e.EFF(74,"Commission Details"),e.k0s(),e.j41(75,"div",21)(76,"ion-select",22),e.bIt("ionChange",function(s){return n.onSortStatusChange(s)}),e.j41(77,"ion-select-option",23),e.EFF(78,"All"),e.k0s(),e.j41(79,"ion-select-option",24),e.EFF(80,"Paid"),e.k0s(),e.j41(81,"ion-select-option",25),e.EFF(82,"Unpaid"),e.k0s()(),e.j41(83,"div",26)(84,"ion-checkbox",27),e.bIt("ionChange",function(s){return n.onSelectAllChange(s)}),e.EFF(85," Select All "),e.k0s()()()(),e.j41(86,"div",8)(87,"div",28)(88,"table",29)(89,"thead",30)(90,"tr")(91,"th",31)(92,"ion-checkbox",32),e.bIt("ionChange",function(s){return n.onSelectAllChange(s)}),e.k0s()(),e.j41(93,"th"),e.EFF(94,"Order Number"),e.k0s(),e.j41(95,"th"),e.EFF(96,"Commission Amount"),e.k0s(),e.j41(97,"th"),e.EFF(98,"Date"),e.k0s(),e.j41(99,"th"),e.EFF(100,"Status"),e.k0s()()(),e.j41(101,"tbody"),e.DNE(102,y,13,9,"tr",33)(103,k,3,0,"tr",34),e.k0s()()(),e.DNE(104,j,7,2,"div",35),e.k0s()(),e.j41(105,"div",5)(106,"div",6)(107,"h5",7),e.EFF(108,"Settlement Summary"),e.k0s()(),e.j41(109,"div",8)(110,"div",9)(111,"div",14)(112,"div",15)(113,"h6",16),e.EFF(114,"Total Settlements"),e.k0s(),e.j41(115,"h3",7),e.EFF(116),e.k0s()()(),e.j41(117,"div",14)(118,"div",15)(119,"h6",16),e.EFF(120,"Total Amount Paid"),e.k0s(),e.j41(121,"h3",7),e.EFF(122),e.nI1(123,"number"),e.k0s()()(),e.j41(124,"div",14)(125,"div",15)(126,"h6",16),e.EFF(127,"Average Settlement"),e.k0s(),e.j41(128,"h3",7),e.EFF(129),e.nI1(130,"number"),e.k0s()()(),e.j41(131,"div",14)(132,"div",15)(133,"h6",16),e.EFF(134,"Last Settlement"),e.k0s(),e.j41(135,"h3",7),e.EFF(136),e.nI1(137,"date"),e.k0s()()()()()(),e.j41(138,"div",5)(139,"div",20)(140,"h5",7),e.EFF(141,"Settlement History"),e.k0s()(),e.j41(142,"div",8),e.DNE(143,_,2,0,"div",36)(144,R,4,2,"div",34),e.k0s()()()),2&t){let o;e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(12),e.Lme("",(null==n.deliveryBoy?null:n.deliveryBoy.firstName)||"N/A"," ",(null==n.deliveryBoy?null:n.deliveryBoy.lastName)||"N/A",""),e.R7$(6),e.JRh((null==n.deliveryBoy?null:n.deliveryBoy.phoneNumber)||"N/A"),e.R7$(6),e.JRh((null==n.deliveryBoy?null:n.deliveryBoy.dateOfBirth)||"N/A"),e.R7$(6),e.JRh((null==n.deliveryBoy?null:n.deliveryBoy.address)||"N/A"),e.R7$(12),e.JRh(n.totalOrdersDelivered||0),e.R7$(6),e.SpI("\u20b9",n.totalEarnings||0,""),e.R7$(6),e.JRh(n.totalOrdersSettled||0),e.R7$(2),e.SpI("\u20b9",n.totalEarningsSettled||0,""),e.R7$(6),e.JRh(n.totalOrdersUnsettled||0),e.R7$(2),e.SpI("\u20b9",n.totalEarningsUnsettled||0,""),e.R7$(6),e.Y8G("value",n.sortStatus),e.R7$(8),e.Y8G("checked",n.selectAll),e.R7$(8),e.Y8G("checked",n.selectAll),e.R7$(10),e.Y8G("ngForOf",n.getFilteredEarnings()),e.R7$(),e.Y8G("ngIf",!(null!=(o=n.getFilteredEarnings())&&o.length)),e.R7$(),e.Y8G("ngIf",n.selectedEarnings.length>0),e.R7$(12),e.JRh(n.settlementSummary.totalSettlements),e.R7$(6),e.SpI("\u20b9",e.i5U(123,25,n.settlementSummary.totalAmountPaid,"1.0-0"),""),e.R7$(7),e.SpI("\u20b9",e.i5U(130,28,n.settlementSummary.averageSettlement,"1.0-0"),""),e.R7$(7),e.SpI(" ",n.settlementSummary.lastSettlementDate?e.i5U(137,31,n.settlementSummary.lastSettlementDate,"mediumDate"):"N/A"," "),e.R7$(7),e.Y8G("ngIf",n.settlementLoading),e.R7$(),e.Y8G("ngIf",!n.settlementLoading)}},dependencies:[v.Sq,v.bT,a.In,a.Jm,a.QW,a.eY,a.W9,a.eU,a.iq,a.Nm,a.Ip,a.w2,a.BC,a.ai,a.hB,a.Je,a.el,v.QX,v.vh]}),d})()}];let A=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[p.iI.forChild(I),p.iI]}),d})(),w=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[v.MD,E.YN,a.bv,A]}),d})()}}]);